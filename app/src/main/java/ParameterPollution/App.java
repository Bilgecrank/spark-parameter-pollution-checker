/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package ParameterPollution;

import java.util.ArrayList;
import java.util.Set;
import spark.Request;
import static spark.Spark.*;

public class App {

    /**
     * Retrieves params passed in a request and then returns them in an HTML
     * string to be displayed.
     * 
     * @param request The request being passed
     * @param type The string representation of the type of request either
     * GET or POST
     * @return The params in STRING form.
     */
    private static String getParamsPassed(Request request, String type) {
        Set<String> queryParams = request.queryParams();
        String getInstance = "<h2>" + type + " Instance</h2><ul>";
        String paramsInstance = "";
            for (String param : queryParams) {
                if (request.queryParams(param) != null) {
                    paramsInstance = paramsInstance.concat("<li>" + param + ": " + 
                        request.queryParams(param) + "</li>");
                }
            }
            if (paramsInstance.equals("")) {
                return paramsInstance;
            } else {
                getInstance = getInstance.concat(paramsInstance);
            }
            getInstance = getInstance.concat("</ul>");
        return getInstance;
    }
    
    public static void main(String[] args) {

        // GOTO: http://localhost:4567
        //GET TESTING
        ArrayList<String> instances = new ArrayList<>();
        String formBody = "<form action=\"/postTester\" method=\"post\">"
                + "<label>Username</label><br>"
                + "<input class=\"registration\" type=\"text\" name=\"username\" placeholder=\"Required\"><br>"
                + "<label>Password</label><br>"
                + "<input class=\"registration\" type=\"password\" name=\"password\" placeholder=\"Required\"><br>"
                + "<input type=\"submit\" value=\"Login\">"
                + "</form>";

        String returnHome = "<br><a href=\"/\">Return HOME</a></body></html>";

        get("/", (request, response) -> "<html><body><h1>HTTP Paramater Pollution GET Testing</h1>"
                + "<ul>"
                + "<li><a href=\"/getTester\">GET Tester</a></li>"
                + "<li><a href=\"/postTester\">POST Tester</a></li>"
                + "</ul>"
                + "</body></html>");

        get("/getTester", (request, response) -> {
            instances.add(getParamsPassed(request, "GET"));
            String bulkReturn = "";
            for (String instance : instances) {
                bulkReturn = bulkReturn + instance;
            }
            if (bulkReturn.equals("")) {
                bulkReturn = "To test get parameters append ?username=Test&"
                        + "password=TestPass to the address string and hit enter.<br>";
            }
            return "<html><body><h1>HTTP Paramater Pollution GET Testing</h1>"
                    + bulkReturn
                    + returnHome;
        });

        //POST TESTING
        get("/postTester", (request, response)
                -> "<html><body><h1>HTTP Paramater Pollution POST Testing</h1>"
                + formBody
                + returnHome
        );

        post("/postTester", (request, response) -> {
            instances.add(getParamsPassed(request, "POST"));
            String bulkReturn = "";
            for (String instance : instances) {
                bulkReturn = bulkReturn + instance;
            }
            return "<html><body><h1>HTTP Paramater Pollution POST Testing</h1>"
                    + formBody
                    + bulkReturn
                    + returnHome;
        });
    }

}
